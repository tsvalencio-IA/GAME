<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>thIAguinho WII: ULTIMATE FIXED</title>
    
    <!-- TENSORFLOW.JS (Core & Models) -->
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs-core"></script>
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs-converter"></script>
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs-backend-webgl"></script>
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow-models/pose-detection"></script>

    <!-- TAILWIND CSS -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- FONTS -->
    <link href="https://fonts.googleapis.com/css2?family=Russo+One&family=Teko:wght@300;500;700&display=swap" rel="stylesheet">

    <style>
        :root {
            --neon-blue: #00F3FF;
            --neon-pink: #FF0055;
            --neon-green: #00FF9D;
        }

        body {
            background-color: #000;
            margin: 0;
            overflow: hidden;
            font-family: 'Teko', sans-serif;
            touch-action: none;
            user-select: none;
            -webkit-user-select: none;
        }

        /* LAYOUT */
        #game-container { position: relative; width: 100vw; height: 100vh; overflow: hidden; }

        /* V√çDEO (Espelho Visual) */
        #webcam {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            object-fit: cover;
            transform: scaleX(-1);
            filter: brightness(0.4) contrast(1.1);
            z-index: 0;
            pointer-events: none;
        }

        /* CANVAS */
        #game-canvas {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            z-index: 10;
            pointer-events: none;
        }

        /* UI LAYER - CR√çTICO: pointer-events none para n√£o bloquear, mas filhos ter√£o auto */
        #ui-layer {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            z-index: 20;
            pointer-events: none; 
            display: flex; flex-direction: column;
        }

        /* ELEMENTOS INTERATIVOS DEVEM TER ISSO */
        .interactive { pointer-events: auto !important; cursor: pointer; }

        /* MENU CARDS */
        .game-card {
            background: rgba(20, 20, 20, 0.9);
            border: 2px solid #333;
            border-radius: 12px;
            transition: all 0.2s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            box-shadow: 0 5px 15px rgba(0,0,0,0.5);
            position: relative;
            overflow: hidden;
        }
        .game-card:active { transform: scale(0.95); border-color: white; }
        
        /* HOVER EFFECTS (Desktop) & ACTIVE STATE (Mobile) */
        .game-card.kart { border-bottom: 4px solid var(--neon-blue); }
        .game-card.run { border-bottom: 4px solid var(--neon-green); }
        .game-card.box { border-bottom: 4px solid var(--neon-pink); }

        .title-glitch {
            font-family: 'Russo One', sans-serif;
            text-shadow: 2px 2px 0px var(--neon-blue), -2px -2px 0px var(--neon-pink);
        }

        /* HUD */
        .hud-panel {
            background: rgba(0, 0, 0, 0.7);
            border: 1px solid rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(4px);
            border-radius: 8px;
            padding: 5px 15px;
        }

        /* LOADER */
        .loader {
            width: 40px; height: 40px; border: 4px solid #fff;
            border-bottom-color: transparent; border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        @keyframes spin { 100% { transform: rotate(360deg); } }
    </style>
</head>
<body>

    <div id="game-container">
        <!-- WEBCAM -->
        <video id="webcam" autoplay muted playsinline></video>
        
        <!-- CANVAS -->
        <canvas id="game-canvas"></canvas>

        <!-- UI -->
        <div id="ui-layer">
            
            <!-- TELA DE LOADING (Inicia Vis√≠vel) -->
            <div id="screen-load" class="absolute inset-0 bg-black z-50 flex flex-col items-center justify-center interactive">
                <div class="loader mb-4"></div>
                <h1 class="text-3xl text-white title-glitch mb-2">thIAguinho WII</h1>
                <p id="load-status" class="text-gray-500 text-sm tracking-widest">INICIALIZANDO SISTEMA...</p>
            </div>

            <!-- MENU PRINCIPAL (Inicia Oculto) -->
            <div id="screen-menu" class="hidden absolute inset-0 bg-black/90 backdrop-blur-md z-40 flex-col items-center justify-center interactive p-4">
                <div class="text-center mb-8">
                    <h1 class="text-5xl md:text-7xl text-white title-glitch leading-none">
                        th<span class="text-cyan-400">IA</span>guinho
                    </h1>
                    <p class="text-gray-400 text-lg tracking-widest mt-2">ARCADE COLLECTION</p>
                </div>

                <div class="flex flex-col w-full max-w-md gap-4">
                    <!-- BOT√ÉO KART -->
                    <div onclick="App.start('kart')" class="game-card kart h-24 flex items-center px-6 interactive w-full">
                        <div class="text-4xl mr-4">üèéÔ∏è</div>
                        <div class="flex-1 text-left">
                            <h2 class="text-2xl text-white font-bold leading-none">NEON KART</h2>
                            <p class="text-gray-400 text-sm">Use as m√£os como volante</p>
                        </div>
                        <div class="text-cyan-400 font-bold text-xl">GO</div>
                    </div>

                    <!-- BOT√ÉO RUN -->
                    <div onclick="App.start('run')" class="game-card run h-24 flex items-center px-6 interactive w-full">
                        <div class="text-4xl mr-4">üèÉ</div>
                        <div class="flex-1 text-left">
                            <h2 class="text-2xl text-white font-bold leading-none">STREET RUN</h2>
                            <p class="text-gray-400 text-sm">Corra e pule no lugar</p>
                        </div>
                        <div class="text-green-400 font-bold text-xl">GO</div>
                    </div>

                    <!-- BOT√ÉO BOX -->
                    <div onclick="App.start('box')" class="game-card box h-24 flex items-center px-6 interactive w-full">
                        <div class="text-4xl mr-4">ü•ä</div>
                        <div class="flex-1 text-left">
                            <h2 class="text-2xl text-white font-bold leading-none">RHYTHM BOX</h2>
                            <p class="text-gray-400 text-sm">Soco no ritmo da m√∫sica</p>
                        </div>
                        <div class="text-pink-500 font-bold text-xl">GO</div>
                    </div>
                </div>
                
                <p class="text-gray-600 text-xs mt-8 text-center max-w-xs">
                    *Mantenha o celular na vertical e afaste-se 1.5 metros da c√¢mera.*
                </p>
            </div>

            <!-- HUD DO JOGO -->
            <div id="screen-hud" class="hidden w-full h-full flex-col justify-between p-4 pointer-events-none">
                <!-- Topo -->
                <div class="flex justify-between items-start">
                    <div class="hud-panel flex flex-col items-center">
                        <span class="text-xs text-gray-400 uppercase tracking-widest">SCORE</span>
                        <span id="hud-score" class="text-3xl text-white font-bold leading-none">0</span>
                    </div>
                    <button onclick="App.stop()" class="interactive bg-red-600/20 border border-red-500 text-red-500 w-10 h-10 rounded-full font-bold flex items-center justify-center backdrop-blur">
                        ‚úï
                    </button>
                </div>

                <!-- Mensagem Central -->
                <div id="hud-msg" class="absolute inset-0 flex items-center justify-center pointer-events-none">
                    <h2 id="msg-text" class="text-5xl font-black text-white italic drop-shadow-lg opacity-0 transition-opacity duration-200 text-center" style="-webkit-text-stroke: 1px black;"></h2>
                </div>

                <!-- Barra Inferior (Velocidade/Status) -->
                <div class="w-full flex flex-col items-center pb-6">
                    <div id="hud-bar-container" class="hidden w-64 h-3 bg-gray-800 rounded-full overflow-hidden border border-gray-600 mb-2">
                        <div id="hud-bar-fill" class="h-full bg-gradient-to-r from-green-500 to-cyan-400 w-0 transition-all duration-100"></div>
                    </div>
                    <span id="hud-status" class="text-xs font-bold text-cyan-400 bg-black/60 px-3 py-1 rounded-full">AGUARDANDO...</span>
                </div>
            </div>

        </div>
    </div>

    <script>
        /**
         * =========================================================================
         * MOTOR GR√ÅFICO (Canvas 2D)
         * =========================================================================
         */
        const Gfx = {
            canvas: document.getElementById('game-canvas'),
            ctx: null,
            width: 0, height: 0,

            init: () => {
                Gfx.ctx = Gfx.canvas.getContext('2d', { alpha: true });
                window.addEventListener('resize', Gfx.resize);
                Gfx.resize();
            },

            resize: () => {
                const dpr = window.devicePixelRatio || 1;
                Gfx.width = window.innerWidth;
                Gfx.height = window.innerHeight;
                Gfx.canvas.width = Gfx.width * dpr;
                Gfx.canvas.height = Gfx.height * dpr;
                Gfx.ctx.scale(dpr, dpr);
            },

            clear: () => Gfx.ctx.clearRect(0, 0, Gfx.width, Gfx.height),

            // Desenhar Esqueleto
            drawSkeleton: (pose, color) => {
                if (!pose) return;
                const ctx = Gfx.ctx;
                ctx.save();
                ctx.strokeStyle = color; ctx.lineWidth = 6; ctx.lineCap = 'round';
                
                const path = (p1, p2) => {
                    if (p1.score > 0.3 && p2.score > 0.3) {
                        ctx.beginPath(); ctx.moveTo(p1.x, p1.y); ctx.lineTo(p2.x, p2.y); ctx.stroke();
                    }
                };
                
                path(pose.shoulders.l, pose.shoulders.r);
                path(pose.shoulders.l, pose.elbows.l); path(pose.elbows.l, pose.wrists.l);
                path(pose.shoulders.r, pose.elbows.r); path(pose.elbows.r, pose.wrists.r);
                
                ctx.restore();
            },

            // Volante Virtual
            drawSteeringWheel: (angle, active) => {
                const ctx = Gfx.ctx;
                const cx = Gfx.width / 2;
                const cy = 150;
                
                ctx.save();
                ctx.translate(cx, cy);
                ctx.rotate(angle);
                
                ctx.beginPath(); ctx.arc(0,0, 60, 0, Math.PI*2);
                ctx.lineWidth = 10;
                ctx.strokeStyle = active ? '#00F3FF' : 'rgba(255,255,255,0.3)';
                ctx.stroke();
                
                ctx.beginPath(); ctx.moveTo(-60,0); ctx.lineTo(60,0); 
                ctx.lineWidth = 6; ctx.stroke();
                
                ctx.restore();
            }
        };

        /**
         * =========================================================================
         * MOTION ENGINE (Pose Detection + Corre√ß√£o de Espelho)
         * =========================================================================
         */
        const Motion = {
            detector: null,
            video: document.getElementById('webcam'),
            prevPose: null,
            lastTime: 0,

            init: async () => {
                const status = document.getElementById('load-status');
                try {
                    await tf.setBackend('webgl');
                    status.innerText = "LIGANDO C√ÇMERA...";
                    
                    const stream = await navigator.mediaDevices.getUserMedia({
                        video: { facingMode: 'user', width: { ideal: 640 }, height: { ideal: 480 } },
                        audio: false
                    });
                    Motion.video.srcObject = stream;
                    await new Promise(r => Motion.video.onloadedmetadata = r);
                    Motion.video.play();

                    status.innerText = "CARREGANDO IA...";
                    const config = { modelType: poseDetection.movenet.modelType.SINGLEPOSE_LIGHTNING };
                    Motion.detector = await poseDetection.createDetector(poseDetection.SupportedModels.MoveNet, config);
                    
                    return true;
                } catch (e) {
                    alert("ERRO: Ative a c√¢mera e use HTTPS. " + e.message);
                    return false;
                }
            },

            update: async () => {
                if (!Motion.detector) return null;
                
                const now = performance.now();
                const dt = Math.min((now - Motion.lastTime)/1000, 0.1);
                Motion.lastTime = now;

                const poses = await Motion.detector.estimatePoses(Motion.video);
                if (poses.length === 0) return null;

                const raw = poses[0].keypoints;
                
                // Mapeamento Inteligente (Cover + Mirror Fix)
                const vw = Motion.video.videoWidth;
                const vh = Motion.video.videoHeight;
                const sw = Gfx.width;
                const sh = Gfx.height;
                const scale = Math.max(sw / vw, sh / vh);
                const ox = (sw - (vw * scale)) / 2;
                const oy = (sh - (vh * scale)) / 2;

                const map = (kp) => ({
                    // INVERS√ÉO DO X: width - valor calculado
                    x: sw - (((vw - kp.x) * scale) + ox), 
                    y: (kp.y * scale) + oy,
                    score: kp.score
                });

                const find = n => raw.find(k => k.name === n);
                
                const p = {
                    nose: map(find('nose')),
                    shoulders: { l: map(find('left_shoulder')), r: map(find('right_shoulder')) },
                    wrists: { l: map(find('left_wrist')), r: map(find('right_wrist')) },
                    elbows: { l: map(find('left_elbow')), r: map(find('right_elbow')) },
                    dt: dt
                };

                p.center = { 
                    x: (p.shoulders.l.x + p.shoulders.r.x) / 2, 
                    y: (p.shoulders.l.y + p.shoulders.r.y) / 2 
                };
                
                // Largura do corpo para normaliza√ß√£o
                p.width = (p.shoulders.l.score > 0.3 && p.shoulders.r.score > 0.3) 
                    ? Math.hypot(p.shoulders.l.x - p.shoulders.r.x, p.shoulders.l.y - p.shoulders.r.y) 
                    : (Motion.prevPose ? Motion.prevPose.width : 100);

                // Suaviza√ß√£o simples
                if (Motion.prevPose) {
                    const alpha = 0.5;
                    p.center.x = p.center.x * alpha + Motion.prevPose.center.x * (1-alpha);
                    p.center.y = p.center.y * alpha + Motion.prevPose.center.y * (1-alpha);
                }
                
                Motion.prevPose = p;
                return p;
            }
        };

        /**
         * =========================================================================
         * JOGO 1: KART
         * =========================================================================
         */
        class GameKart {
            constructor() {
                this.speed = 0;
                this.angle = 0;
                this.carX = 0;
                this.score = 0;
                this.obstacles = [];
                document.getElementById('hud-gauge-container').classList.remove('hidden');
                document.getElementById('hud-status').innerText = "LEVANTE AS M√ÉOS";
                App.msg("START!", "#00F3FF");
            }

            update(pose, ctx, w, h) {
                // Volante
                let active = false;
                let targetAngle = 0;

                if (pose.wrists.l.score > 0.4 && pose.wrists.r.score > 0.4) {
                    if (pose.wrists.l.y < h * 0.7) { // M√£os levantadas
                        active = true;
                        const dy = pose.wrists.r.y - pose.wrists.l.y;
                        const dx = pose.wrists.r.x - pose.wrists.l.x;
                        const raw = Math.atan2(dy, dx);
                        
                        // Corre√ß√£o com ombros
                        const sDy = pose.shoulders.r.y - pose.shoulders.l.y;
                        const sDx = pose.shoulders.r.x - pose.shoulders.l.x;
                        const body = Math.atan2(sDy, sDx);
                        
                        targetAngle = raw - body;
                        targetAngle = Math.max(-1.2, Math.min(1.2, targetAngle)); // Limit
                        
                        this.speed = Math.min(150, this.speed + 60 * pose.dt);
                    }
                }

                if (!active) {
                    this.speed *= 0.95;
                    targetAngle = 0;
                }

                this.angle += (targetAngle - this.angle) * 5 * pose.dt;
                
                // F√≠sica
                const curve = Math.sin(Date.now() / 2000) * 0.6;
                this.carX += (this.angle * 3.0 - curve * (this.speed/100)) * pose.dt;
                if (this.carX < -1.5) { this.carX = -1.5; this.speed *= 0.8; }
                if (this.carX > 1.5) { this.carX = 1.5; this.speed *= 0.8; }

                this.score += Math.floor(this.speed * pose.dt);

                // Render
                ctx.clearRect(0,0,w,h);
                const hz = h * 0.4;
                
                // Estrada
                ctx.fillStyle = '#111';
                ctx.beginPath();
                const top = w/2 + (curve * 200);
                const bot = w/2 + (this.carX * -300);
                ctx.moveTo(top-10, hz); ctx.lineTo(top+10, hz);
                ctx.lineTo(bot+w, h); ctx.lineTo(bot-w, h);
                ctx.fill();

                // Obst√°culos
                if (Math.random() < 0.02 && this.speed > 30) this.obstacles.push({x: (Math.random()-0.5)*2.5, z: 0});
                
                this.obstacles.forEach((obs, i) => {
                    obs.z += this.speed * 0.002 * pose.dt * 60;
                    if (obs.z > 1.2) { this.obstacles.splice(i,1); return; }
                    
                    const drawY = hz + (obs.z * (h-hz));
                    const roadX = top + (bot - top) * obs.z;
                    const drawX = roadX + (obs.x * w * 0.5 * obs.z);
                    const size = 40 * obs.z * obs.z;

                    ctx.fillStyle = '#FF0055';
                    ctx.fillRect(drawX - size/2, drawY - size, size, size);

                    if (obs.z > 0.85 && obs.z < 0.95 && Math.abs(drawX - w/2) < 80) {
                        this.speed = 10;
                        App.msg("BATEU!", "red");
                        ctx.fillStyle = 'white'; ctx.fillRect(0,0,w,h);
                    }
                });

                // Carro HUD
                Gfx.drawSteeringWheel(this.angle, active);
                
                // Desenha Esqueleto
                Gfx.drawSkeleton(pose, active ? '#00F3FF' : '#555');

                document.getElementById('hud-gauge-fill').style.width = (this.speed/150)*100 + '%';
                return this.score;
            }
        }

        /**
         * =========================================================================
         * JOGO 2: RUN
         * =========================================================================
         */
        class GameRun {
            constructor() {
                this.score = 0;
                this.speed = 0;
                this.lane = 0;
                this.playerY = 0;
                this.jumpVel = 0;
                this.energy = 0;
                this.lastY = 0;
                this.obstacles = [];
                document.getElementById('hud-gauge-container').classList.remove('hidden');
                document.getElementById('hud-subtext').innerText = "CORRA NO LUGAR";
                App.msg("GO!", "#00FF9D");
            }

            update(pose, ctx, w, h) {
                // Dire√ß√£o Lateral
                if (pose.shoulders.l.score > 0.4) {
                    const diffX = pose.center.x - (w/2);
                    if (diffX < -w*0.1) this.lane = -1;
                    else if (diffX > w*0.1) this.lane = 1;
                    else this.lane = 0;

                    // Corrida (Bounce)
                    if (!this.lastY) this.lastY = pose.center.y;
                    const delta = Math.abs(pose.center.y - this.lastY);
                    this.lastY = pose.center.y;
                    
                    if (delta/pose.width > 0.03) this.energy = Math.min(1, this.energy + 2*pose.dt);
                    else this.energy = Math.max(0, this.energy - 1*pose.dt);
                    
                    this.speed = this.energy * 80;

                    // Pulo
                    if (this.playerY === 0 && pose.wrists.l.y < pose.nose.y) {
                        this.jumpVel = 20; this.playerY = 1; App.msg("PULO!", "#00FF9D");
                    }
                }

                // F√≠sica Pulo
                if (this.playerY > 0) {
                    this.playerY += this.jumpVel * pose.dt * 2;
                    this.jumpVel -= 60 * pose.dt;
                    if (this.playerY <= 0) { this.playerY = 0; this.jumpVel = 0; }
                }

                this.score += Math.floor(this.speed * pose.dt);

                // Render
                ctx.clearRect(0,0,w,h);
                const hz = h * 0.4;
                ctx.fillStyle = '#111'; ctx.fillRect(0,hz,w,h); // Ch√£o
                
                // Grid
                ctx.strokeStyle = '#00FF9D'; ctx.lineWidth = 2; ctx.beginPath();
                ctx.moveTo(w/2, hz); ctx.lineTo(w*0.2, h);
                ctx.moveTo(w/2, hz); ctx.lineTo(w*0.5, h);
                ctx.moveTo(w/2, hz); ctx.lineTo(w*0.8, h);
                ctx.stroke();

                // Obst√°culos
                if (Math.random() < 0.02 && this.speed > 5) this.obstacles.push({lane: Math.floor(Math.random()*3)-1, z:0});
                
                this.obstacles.forEach((obs, i) => {
                    obs.z += (this.speed * 0.005 + 0.02) * 60 * pose.dt;
                    if (obs.z > 1.2) { this.obstacles.splice(i,1); return; }

                    const roadW = w * 2 * obs.z;
                    const drawX = (w/2) + (obs.lane * roadW * 0.15);
                    const drawY = hz + (obs.z * (h-hz));
                    const size = 50 * obs.z;

                    ctx.fillStyle = '#FF0055';
                    ctx.fillRect(drawX - size/2, drawY - size, size, size);

                    // Colis√£o
                    if (obs.z > 0.85 && obs.z < 0.95 && obs.lane === this.lane && this.playerY === 0) {
                        this.speed = 0; this.energy = 0;
                        App.msg("BATIDA!", "red");
                        ctx.fillStyle = 'white'; ctx.fillRect(0,0,w,h);
                        this.obstacles.splice(i,1);
                    }
                });

                // Avatar
                ctx.save();
                ctx.translate(this.lane * 100, this.playerY * -200);
                Gfx.drawSkeleton(pose, '#00FF9D');
                ctx.restore();

                document.getElementById('hud-gauge-fill').style.width = (this.speed/80)*100 + '%';
                return this.score;
            }
        }

        /**
         * =========================================================================
         * JOGO 3: BOX
         * =========================================================================
         */
        class GameBox {
            constructor() {
                this.score = 0;
                this.targets = [];
                this.timer = 0;
                document.getElementById('hud-gauge-container').classList.add('hidden');
                document.getElementById('hud-subtext').innerText = "SOQUE AS BOLHAS";
                App.msg("FIGHT!", "#FF0055");
            }

            update(pose, ctx, w, h) {
                this.timer += pose.dt;
                if (this.timer > 0.8) {
                    this.timer = 0;
                    const side = Math.random() > 0.5 ? 'left' : 'right';
                    this.targets.push({
                        x: side === 'left' ? w*0.25 : w*0.75,
                        y: h*0.3 + Math.random()*h*0.3,
                        r: 10, active: true, side: side,
                        color: side === 'left' ? '#00F3FF' : '#FF0055'
                    });
                }

                ctx.clearRect(0,0,w,h);
                Gfx.drawSkeleton(pose, '#555');

                this.targets.forEach(t => {
                    if (!t.active) return;
                    t.r += 100 * pose.dt;

                    ctx.beginPath(); ctx.arc(t.x, t.y, t.r, 0, Math.PI*2);
                    ctx.strokeStyle = t.color; ctx.lineWidth = 4; ctx.stroke();
                    ctx.fillStyle = t.color + '44'; ctx.fill();

                    // Hit
                    if (pose && t.r > 40) {
                        const hand = t.side === 'left' ? pose.wrists.l : pose.wrists.r;
                        const dist = Math.hypot(hand.x - t.x, hand.y - t.y);
                        if (dist < t.r + 30) {
                            t.active = false;
                            this.score += 100;
                            App.msg("HIT!", t.color);
                            // Explosion
                            ctx.fillStyle = 'white'; ctx.beginPath(); ctx.arc(t.x, t.y, 80, 0, Math.PI*2); ctx.fill();
                        }
                    }
                    if (t.r > 100) t.active = false;
                });
                this.targets = this.targets.filter(t => t.active);

                // Luvas
                const glove = (p, c) => {
                    if(p.score > 0.3) {
                        ctx.fillStyle = c; ctx.beginPath(); ctx.arc(p.x, p.y, 30, 0, Math.PI*2); ctx.fill();
                    }
                };
                glove(pose.wrists.l, '#00F3FF'); glove(pose.wrists.r, '#FF0055');

                return this.score;
            }
        }

        /**
         * =========================================================================
         * APP MAIN
         * =========================================================================
         */
        const App = {
            game: null,
            loopId: null,

            init: async () => {
                Gfx.init();
                const ready = await Motion.init();
                if (ready) {
                    document.getElementById('screen-load').classList.add('hidden');
                    document.getElementById('screen-menu').classList.remove('hidden');
                    document.getElementById('screen-menu').classList.add('flex');
                }
            },

            start: (type) => {
                document.getElementById('screen-menu').classList.remove('flex');
                document.getElementById('screen-menu').classList.add('hidden');
                document.getElementById('screen-hud').classList.remove('hidden');
                document.getElementById('screen-hud').classList.add('flex');

                if (type === 'kart') App.game = new GameKart();
                if (type === 'run') App.game = new GameRun();
                if (type === 'box') App.game = new GameBox();

                App.loop();
            },

            stop: () => {
                cancelAnimationFrame(App.loopId);
                App.game = null;
                document.getElementById('screen-hud').classList.add('hidden');
                document.getElementById('screen-menu').classList.remove('hidden');
                document.getElementById('screen-menu').classList.add('flex');
                Gfx.clear();
            },

            msg: (text, color) => {
                const el = document.getElementById('msg-text');
                el.innerText = text; el.style.color = color; el.style.opacity = 1;
                setTimeout(() => el.style.opacity = 0, 500);
            },

            loop: async () => {
                if (!App.game) return;
                const pose = await Motion.update(Gfx.width, Gfx.height);
                if (pose) {
                    const score = App.game.update(pose, Gfx.ctx, Gfx.width, Gfx.height);
                    document.getElementById('hud-score').innerText = score;
                }
                App.loopId = requestAnimationFrame(App.loop);
            }
        };

        window.onload = App.init;

    </script>
</body>
</html>
