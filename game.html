<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>thIAguinho Engine Pro</title>
    <link rel="stylesheet" href="css/style.css">
    <link href="https://cdn.jsdelivr.net/npm/boxicons@2.1.4/css/boxicons.min.css" rel="stylesheet">
    
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/pose/pose.js" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils/camera_utils.js" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.146.0/build/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.146.0/examples/js/loaders/GLTFLoader.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.146.0/examples/js/loaders/DRACOLoader.js"></script>

    <style>
        #debug-console {
            position: fixed; top: 0; left: 0; width: 100%; background: rgba(0,0,0,0.8);
            color: lime; font-family: monospace; font-size: 10px; padding: 5px;
            z-index: 9999; display: none; pointer-events: none; max-height: 100px; overflow: hidden;
        }
    </style>
</head>
<body>
    <div id="debug-console">Init...</div>

    <div id="game-wrapper">
        <video id="input-video" playsinline muted autoplay style="position:absolute; width:1px; height:1px; opacity:0.01; z-index:-1;"></video>
        
        <video id="camera-feed"></video>
        <canvas id="game-canvas"></canvas>

        <div id="hud-layer">
            <div class="hud-header">
                <button class="hud-btn" onclick="Engine.togglePause()"><i class='bx bx-pause'></i></button>
                <div class="score-pill">
                    <div class="score-label">SCORE</div>
                    <div class="score-val" id="score-display">0</div>
                </div>
            </div>

            <div id="touch-controls" class="touch-zone hidden">
                <div id="touch-hint-text" class="touch-hint">TOQUE PARA COMEÇAR</div>
            </div>
            
            <div id="toast" class="toast-msg hidden">GO!</div>
        </div>

        <div id="screen-loading" class="modal-overlay">
            <div class="modal-box">
                <div class="spinner"></div>
                <h2 class="modal-title">CARREGANDO</h2>
                <p id="loading-txt" style="color:#888;">Inicializando Engine...</p>
            </div>
        </div>

        <div id="screen-pause" class="modal-overlay hidden">
            <div class="modal-box">
                <h2 class="modal-title">PAUSA</h2>
                <div style="display:grid; grid-template-columns: 1fr 1fr 1fr; gap:10px; margin:20px 0;">
                    <button class="hud-btn" style="width:100%; border-radius:15px;" onclick="Input.setMode('TOUCH')"><i class='bx bxs-hand-up'></i></button>
                    <button class="hud-btn" style="width:100%; border-radius:15px;" onclick="Input.setMode('TILT')"><i class='bx bx-mobile-vibration'></i></button>
                    <button class="hud-btn" style="width:100%; border-radius:15px;" onclick="Input.setMode('BODY')"><i class='bx bx-body'></i></button>
                </div>
                <button class="btn-primary" onclick="Engine.togglePause()">CONTINUAR</button>
                <button class="btn-secondary" onclick="window.location.href='index.html'">SAIR</button>
            </div>
        </div>

        <div id="screen-calibration" class="modal-overlay hidden">
            <div class="modal-box">
                <i class='bx bx-body' style="font-size:50px; color:var(--wii-blue)"></i>
                <h2 class="modal-title">CALIBRAÇÃO</h2>
                <p>Afaste-se e faça uma pose em "T".</p>
                <div id="calib-status" style="margin:20px; font-weight:bold; color:#ccc;">AGUARDANDO CÂMERA...</div>
                <button class="btn-secondary" onclick="Input.setMode('TOUCH'); Engine.setScreen(null);">CANCELAR</button>
            </div>
        </div>

        <div id="screen-gameover" class="modal-overlay hidden">
            <div class="modal-box">
                <h2 class="modal-title" style="color:var(--nintendo-red)">FIM DE JOGO</h2>
                <div class="score-val" id="final-score" style="font-size:40px; margin:20px 0;">0</div>
                <button class="btn-primary" onclick="Engine.restart()">JOGAR NOVAMENTE</button>
                <button class="btn-secondary" onclick="window.location.href='index.html'">MENU</button>
            </div>
        </div>
    </div>

    <script>
        window.onerror = function(msg, url, line) {
            const d = document.getElementById('debug-console');
            d.style.display = 'block';
            d.innerHTML = `ERRO: ${msg} <br> ${url}:${line}`;
            return false;
        };
        function log(msg) {
            console.log(msg);
        }
    </script>

    <script src="js/vision.js"></script>
    <script src="js/game.js"></script>
</body>
</html>